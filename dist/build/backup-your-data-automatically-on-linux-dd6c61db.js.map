{"version":3,"file":"backup-your-data-automatically-on-linux-dd6c61db.js","sources":["../../src/pages/tutorials/backup-your-data-automatically-on-linux.md"],"sourcesContent":["---\ntitle: How to automatic backup data in Linux\npub:\n- 24\n- Apr\npublished: 2016-04-24T15:37:21+03:00\nmodified: 2016-04-24T15:37:21+03:00\nsummary: Backups are one of the most important things when running a server  and these scripts help backup your important data automatically.\nlayout: tutorial\n---\n\nBackups are one of the most important things when running a server where are clients' data and files. These two scripts help backup your important data from <a href=\"/tutorials/mysql\" title=\"A beginner's guide to MySQL / MariaDB\">MySQL / MariaDB</a> and all the files from the website's folder. You can put both of these scripts in the same file, but I like to keep them separated.\n\n## Backup MySQL / MariaDB databases\n\nData is changing daily and there has to be very recent backup available if something bad happens. You never know what may happen, so better safe than sorry. Most of the time, once per day is enough if you don't run a very popular web store.\n\nThe script wants to know the username and password for the root / backup user which has enough power to fetch databases one by one. What the user needs is **EVENT**, **LOCK TABLES**, **SELECT** and **SHOW DATABASES**. It can't destroy anything so no worries.\n\nFirst, the script defines the variables, which are username, password and where files should end up. Then pull all the databases from the MySQL server to $databases and break it with for loop to $db. Now the script knows the names of the databases.\n\nIf the database is not **information_schema** or start with **_** then use mysqldump to print the content of the database to .**sql** file. After that's done, compress it with **gzip**. The script does this separately for each database.\n\n```Bash\n#!/bin/bash\nUSER=\"backup\"\nPASSWORD=\"L63?aJbR6sFq-LuqNK\"\nOUTPUT=\"/backup/db\"\ndatabases=`mysql --user=$USER --password=$PASSWORD -e \"SHOW DATABASES;\" | tr -d \"| \" | grep -v Database`\nfor db in $databases; do\n  if [[ \"$db\" != \"information_schema\" ]] &amp;&amp; [[ \"$db\" != _* ]] ; then\n  mysqldump --force --opt --user=$USER --password=$PASSWORD --databases $db > $OUTPUT/$db-`date +%Y%m%d`.sql\n  gzip $OUTPUT/$db-`date +%Y%m%d`.sql\n  fi\ndone\n```\n\n## Backup all important files\n\nThe files are not as important as the database, they take up more space, and they are changed less, so I back up those only once per week. I have always two backups available. This script compresses my wwwroot and puts the file to the right location.\n\n```Bash\n!/bin/bash\ntar -zcvf \"/backup/files/www-$(date '+%F').tar.gz\" /wwwroot\n```\n\n## How to schedule a backup\n\nCron is a very powerful tool, and I use that to schedule my backups. Cron enables execute commands or scripts automatically at a specified time/date.\n\nAn entry in cron is made up of a series of fields separated by a space. Cron timing: minute 0-59, hour 0-23, day of month 1-31, month 1-12, day of week 0-6. The first script is run daily at 00:00, the second one runs 23:55 every Friday. The null device is typically used for disposing of unwanted output streams of a process (meaning no one cares what scripts want to tell).\n\nTo command line:\n\n```Bash\n<code>crontab -e\n```\n\nEdit crontab:\n\n```Bash\n0 0 * * * /root/backup-db > /dev/null 2>&amp;1\n55 11 * * Fri /root/backup-files > /dev/null 2>&amp;1\n```\n\nWhat is running:\n\n```Bash\ncrontab -l\n```\n\nOther examples:\n\n```Bash\n15 0 */3 * * Every third day 15 min past midnight.\n15 0 3 * * Every third day of the month.\n15 0 3 3 * Every third day of the third month.\n15 */6 * * * Every sixth hour.\n```\n\n## How to delete old files automatically on Linux\n\nI don't want to keep all backups forever, so this script deletes files older than two weeks. Remember to change the folder. Add this line with scripts above.\n\n```Bash\nfind /backup/files/* -mtime +14 -type f -delete\n```\n\nThanks for reading and happy backuping!"],"names":["metadata","title","pub","published","modified","summary","layout"],"mappings":"yoMAS2BA,4LAAAA,yIARbA,GAAYC,MAAQ,wCAAwCC,KAAO,GAAG,OAAOC,UAAY,2BAA2BC,SAAW,2BAA2BC,QAAU,uIAAuIC,OAAS"}